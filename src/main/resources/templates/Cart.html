<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gi·ªè h√†ng</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" type="text/css" th:href="@{/css/cart.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/css/index.css}">
</head>
<body>
<!-- S·ª≠ d·ª•ng fragment header -->
<div th:replace="fragment/Header :: header(${account})"></div>

<!-- Body -->
<div class="cart-container my-5">
    <h2>Gi·ªè h√†ng</h2>

    <!-- Ki·ªÉm tra n·∫øu gi·ªè h√†ng r·ªóng -->
    <div th:if="${msg != null}">
        <p th:text="${msg}" class="text-danger"></p>
    </div>

    <!-- Hi·ªÉn th·ªã gi·ªè h√†ng n·∫øu c√≥ s·∫£n ph·∫©m -->
    <div class="cart-content" th:if="${cartItems != null}">
        <div class="left-section">
            <!-- Gi·ªè h√†ng -->
            <div class="cart">
                <div class="cart-header">
                    <div class="product-header">
                        <input type="checkbox"/>
                        <p>S·∫£n ph·∫©m</p>
                    </div>
                    <div class="header-item">ƒê∆°n gi√°</div>
                    <div class="header-item">S·ªë l∆∞·ª£ng</div>
                    <div class="header-item">Th√†nh ti·ªÅn</div>
                </div>

                <!-- Duy·ªát qua t·ª´ng s·∫£n ph·∫©m trong gi·ªè h√†ng -->
                <div class="cart-item" th:each="item : ${cartItems}">
                    <div class="product">
                        <input type="checkbox"/>
                        <img th:src="${item.sanPham.image}" alt="·∫¢nh s·∫£n ph·∫©m"/>
                        <div class="product-info">
                            <p class="product-name" th:text="${item.sanPham.tenSanPham}"></p>
                        </div>
                    </div>
                    <div class="price" th:text="${item.sanPham.giaBan} + ' ƒë'"></div>
                    <div class="quantity">
                        <button>-</button>
                        <input type="number" th:value="${item.soLuong}" min="1"/>
                        <button>+</button>
                    </div>
                    <div class="total">
                        <p th:text="${item.sanPham.giaBan * item.soLuong} + ' ƒë'"></p>
                        <button class="delete-item">üóë</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- C·ªôt t√≥m t·∫Øt -->
        <div class="cart-summary">
            <h3>Khuy·∫øn m√£i</h3>
            <div class="promo-code-section">
                <label for="promo-code">Ch·ªçn m√£:</label>
                <select id="promo-code" class="promo-code">
                    <option value="">Ch·ªçn m√£ khuy·∫øn m√£i</option>
                    <option value="PROMO10">Gi·∫£m 10%</option>
                    <option value="FREESHIP">Mi·ªÖn ph√≠ v·∫≠n chuy·ªÉn</option>
                    <option value="DISCOUNT50">Gi·∫£m 50.000 ƒë</option>
                </select>
            </div>
            <div class="summary-details">
                <p>T·∫°m t√≠nh: <span th:text="${totalAmount} + ' ƒë'"></span></p>
                <p>Gi·∫£m gi√° ∆∞u ƒë√£i: <span>-</span></p>
                <p>Gi·∫£m gi√° s·∫£n ph·∫©m: <span>-</span></p>
                <p class="total-summary">T·ªïng ti·ªÅn: <span th:text="${totalAmount} + ' ƒë'"></span></p>
            </div>
            <form action="/thanhtoan" method="POST">
                <button class="buy-button" th:href="@{/thanhtoan}">Mua ngay</button>
            </form>
        </div>
    </div>
</div>

<!-- S·ª≠ d·ª•ng fragment footer -->
<div th:replace="fragment/Footer :: footer"></div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const cartItems = document.querySelectorAll(".cart-item");

        cartItems.forEach((item) => {
            const btnIncrease = item.querySelector(".quantity button:last-child");
            const inputQuantity = item.querySelector(".quantity input");
            const priceElement = item.querySelector(".price");
            const totalElement = item.querySelector(".total p");

            // Chuy·ªÉn gi√° tr·ªã gi√° s·∫£n ph·∫©m v·ªÅ d·∫°ng s·ªë
            const price = parseInt(priceElement.textContent.replace(" ƒë", "").replace(",", ""));

            btnIncrease.addEventListener("click", function () {
                // TƒÉng s·ªë l∆∞·ª£ng
                let quantity = parseInt(inputQuantity.value);
                quantity++;
                inputQuantity.value = quantity;

                // C·∫≠p nh·∫≠t t·ªïng gi√°
                const totalPrice = price * quantity;
                totalElement.textContent = totalPrice.toLocaleString() + " ƒë";
            });
        });
    });
</script>
</body>
</html>
